# TinyList Helm Chart Values
# See https://github.com/zh/tinylist for documentation

# -- Global settings
nameOverride: ""
fullnameOverride: ""

# -- Backend configuration
backend:
  # -- Number of replicas (should be 1 for SQLite)
  replicaCount: 1

  image:
    # -- Backend image repository
    repository: ghcr.io/zh/tinylist/backend
    # -- Image pull policy
    pullPolicy: IfNotPresent
    # -- Image tag (defaults to chart appVersion)
    tag: ""

  # -- Image pull secrets
  imagePullSecrets: []

  # -- Service account configuration
  serviceAccount:
    create: true
    annotations: {}
    name: ""

  # -- Pod annotations
  podAnnotations: {}

  # -- Pod security context
  podSecurityContext:
    fsGroup: 1000

  # -- Container security context
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    readOnlyRootFilesystem: false
    allowPrivilegeEscalation: false

  # -- Service configuration
  service:
    type: ClusterIP
    port: 8080

  # -- Resource limits and requests
  resources:
    requests:
      memory: 64Mi
      cpu: 50m
    limits:
      memory: 128Mi
      cpu: 200m

  # -- Liveness probe configuration
  livenessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 10
    periodSeconds: 30
    timeoutSeconds: 5
    failureThreshold: 3

  # -- Readiness probe configuration
  readinessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  # -- Node selector
  nodeSelector: {}

  # -- Tolerations
  tolerations: []

  # -- Affinity rules
  affinity: {}

# -- Frontend configuration
frontend:
  # -- Enable frontend deployment
  enabled: true

  # -- Number of replicas
  replicaCount: 1

  image:
    # -- Frontend image repository
    repository: ghcr.io/zh/tinylist/frontend
    # -- Image pull policy
    pullPolicy: IfNotPresent
    # -- Image tag (defaults to chart appVersion)
    tag: ""

  # -- Image pull secrets
  imagePullSecrets: []

  # -- Service account configuration
  serviceAccount:
    create: true
    annotations: {}
    name: ""

  # -- Pod annotations
  podAnnotations: {}

  # -- Pod security context
  podSecurityContext: {}

  # -- Container security context
  securityContext:
    runAsNonRoot: true
    runAsUser: 101  # nginx user
    allowPrivilegeEscalation: false

  # -- Service configuration
  service:
    type: ClusterIP
    port: 80

  # -- Resource limits and requests
  resources:
    requests:
      memory: 16Mi
      cpu: 10m
    limits:
      memory: 32Mi
      cpu: 50m

  # -- Liveness probe configuration
  livenessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 5
    periodSeconds: 30
    timeoutSeconds: 5
    failureThreshold: 3

  # -- Readiness probe configuration
  readinessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 3
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  # -- Node selector
  nodeSelector: {}

  # -- Tolerations
  tolerations: []

  # -- Affinity rules
  affinity: {}

# -- TinyList application configuration
config:
  # -- Public URL for verification links (REQUIRED)
  # Example: https://newsletter.example.com
  publicUrl: ""

  # -- Server host
  host: "0.0.0.0"

  # -- Server port
  port: 8080

  # -- Database path (relative to /app in container)
  databasePath: "./data/tinylist.db"

  # -- Sending configuration
  sending:
    # -- Emails per second rate limit
    rateLimit: 10
    # -- Maximum retry attempts
    maxRetries: 3
    # -- Batch size for sending
    batchSize: 100

  # -- Admin authentication (Basic Auth) - REQUIRED
  auth:
    # -- Admin username
    username: admin
    # -- Admin password (REQUIRED - server will not start without this)
    password: ""

# -- Persistence configuration for SQLite database
persistence:
  # -- Enable persistence
  enabled: true

  # -- Storage class (leave empty for default)
  storageClass: ""

  # -- Access mode
  accessMode: ReadWriteOnce

  # -- Storage size
  size: 1Gi

  # -- Existing PVC name (if you want to use existing PVC)
  existingClaim: ""

  # -- Annotations for PVC
  annotations: {}

# -- Ingress configuration
ingress:
  # -- Enable ingress
  enabled: false

  # -- Ingress class name
  className: ""

  # -- Enable path rewriting (for nginx-ingress)
  # Set to true when deploying at a subpath (e.g., /admin)
  # This adds nginx.ingress.kubernetes.io/rewrite-target annotation
  rewriteTarget: false

  # -- Ingress annotations
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod

  # -- Ingress hosts configuration
  #
  # Example 1: Dedicated domain (newsletter.example.com)
  #   hosts:
  #     - host: newsletter.example.com
  #       paths:
  #         - path: /
  #           pathType: Prefix
  #           service: frontend
  #         - path: /api
  #           pathType: Prefix
  #           service: backend
  #
  # Example 2: Subpath on existing domain (example.com/admin)
  # NOTE: Set rewriteTarget: true for this to work with nginx-ingress
  #   hosts:
  #     - host: example.com
  #       paths:
  #         - path: /admin(/|$)(.*)
  #           pathType: ImplementationSpecific
  #           service: frontend
  #         - path: /api(/|$)(.*)
  #           pathType: ImplementationSpecific
  #           service: backend
  hosts:
    - host: newsletter.example.com
      paths:
        # Frontend serves the admin UI
        - path: /
          pathType: Prefix
          service: frontend
        # API routes go to backend
        - path: /api
          pathType: Prefix
          service: backend

  # -- TLS configuration
  tls: []
  #  - secretName: tinylist-tls
  #    hosts:
  #      - newsletter.example.com
